{"version":3,"sources":["./src/app/modules/my-gallery/my-gallery-routing.module.ts","./src/app/modules/my-gallery/my-gallery.module.ts","./src/app/modules/my-gallery/my-gallery.component.ts","./src/app/modules/my-gallery/my-gallery.component.html"],"names":[],"mappings":";;;;;;;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAuD;AACK;;;AAE5D,MAAM,MAAM,GAAW;IACrB;QACE,IAAI,EAAE,EAAE;QACR,SAAS,EAAE,wEAAkB;KAC9B;CACF,CAAC;AAMK,MAAM,qBAAqB;;0FAArB,qBAAqB;oGAArB,qBAAqB;wGAHvB,CAAC,4DAAY,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,EAC9B,4DAAY;mIAEX,qBAAqB,uFAFtB,4DAAY;;;;;;;;;;;;;ACbxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA+C;AAEqB;AACR;;AAMrD,MAAM,eAAe;;8EAAf,eAAe;8FAAf,eAAe;kGAHjB,CAAC,gFAAqB,EAAE,4DAAY,CAAC;mIAGnC,eAAe,mBAFX,wEAAkB,aADvB,gFAAqB,EAAE,4DAAY;;;;;;;;;;;;;ACC/C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAgD;AACJ;AASA;AAE6B;AACZ;;;;;;;ICpB7D,yEAMC;IACC,sEAAK;IACH,oEAAG;IACD,uDACF;IAAA,4DAAI;IACJ,4EAA6C;IAArC,0WAAoC;IAAC,iEAAQ;IAAA,4DAAS;IAChE,4DAAM;IACN,oEAAwC;IAC1C,4DAAM;;;IALA,0DACF;IADE,iGACF;IAGG,0DAAgC;IAAhC,yJAAgC;;ADehC,MAAM,kBAAkB;IAsC7B,YAAoB,MAAoB,EAAU,QAAiB;QAA/C,WAAM,GAAN,MAAM,CAAc;QAAU,aAAQ,GAAR,QAAQ,CAAS;QArC5D,iBAAY,GAA4B,IAAI,CAAC,MAAM,CAAC,IAAI,CAC7D,0DAAM,CAAC,sFAAiB,CAAC,CAC1B,CAAC;QAEM,SAAI,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,0DAAM,CAAC,0EAAa,CAAC,CAAC,CAAC;QAUhD,cAAS,GAAc;YAC5B,KAAK,EAAE,EAAE;YACT,IAAI,EAAE,KAAK;YACX,KAAK,EAAE,EAAE;SACV,CAAC;IAmBoE,CAAC;IAhBhE,cAAc;QACnB,IACE,QAAQ,CAAC,gBAAgB,CAAC,YAAY;YACpC,QAAQ,CAAC,gBAAgB,CAAC,SAAS;YACnC,QAAQ,CAAC,gBAAgB,CAAC,YAAY;YACtC,EAAE;YACJ,IAAI,CAAC,gBAAgB;YACrB,IAAI,CAAC,eAAe,GAAG,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAC1D;YACA,IAAI,CAAC,gBAAgB,GAAG,KAAK,CAAC;YAC9B,IAAI,CAAC,SAAS,CAAC,KAAK,IAAI,EAAE,CAAC;YAC3B,IAAI,CAAC,YAAY,EAAE,CAAC;SACrB;QACD,IAAI,CAAC,eAAe,GAAG,QAAQ,CAAC,gBAAgB,CAAC,SAAS,CAAC;IAC7D,CAAC;IAIM,QAAQ;QACb,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,0FAAe,EAAE,CAAC,CAAC;QAExC,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,EAAE,EAAE;YAClD,IAAI,GAAG,EAAE;gBACP,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,GAAG,CAAC;gBAC3B,IAAI,CAAC,YAAY,EAAE,CAAC;aACrB;QACH,CAAC,CAAC,CAAC;QAEH,MAAM,MAAM,GAAG,IAAI,CAAC,QAAQ;aACzB,IAAI,CAAC,4DAAM,6EAA6C,CAAC;aACzD,SAAS,CAAC,GAAG,EAAE;YACd,IAAI,CAAC,YAAY,EAAE,CAAC;YACpB,MAAM,CAAC,WAAW,EAAE,CAAC;QACvB,CAAC,CAAC,CAAC;QAEL,IAAI,CAAC,wBAAwB,GAAG,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,GAAG,EAAE;YAC/D,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;QAC/B,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,YAAY;QACjB,MAAM,SAAS,qBAAQ,IAAI,CAAC,SAAS,CAAE,CAAC;QACxC,IAAI,SAAS,CAAC,KAAK,EAAE;YACnB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,uFAAY,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC;SACnD;IACH,CAAC;IAEM,aAAa,CAAC,SAAiB;QACpC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,wFAAa,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC;IACrD,CAAC;IAEM,aAAa,CAAC,KAAa,EAAE,IAAY;QAC9C,OAAO,KAAK,CAAC;IACf,CAAC;IAEM,WAAW;QAChB,IAAI,CAAC,wBAAwB,CAAC,WAAW,EAAE,CAAC;QAC5C,IAAI,CAAC,gBAAgB,CAAC,WAAW,EAAE,CAAC;IACtC,CAAC;;oFAhFU,kBAAkB;kGAAlB,kBAAkB;4IAAlB,oBAAgB;;QC5B7B,8GAcM;;;;QAXe,uNACb","file":"modules-my-gallery-my-gallery-module.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { MyGalleryComponent } from './my-gallery.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: MyGalleryComponent,\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class MyGalleryRouterModule {}\r\n","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { MyGalleryRouterModule } from './my-gallery-routing.module';\r\nimport { MyGalleryComponent } from './my-gallery.component';\r\n\r\n@NgModule({\r\n  imports: [MyGalleryRouterModule, CommonModule],\r\n  declarations: [MyGalleryComponent],\r\n})\r\nexport class MyGalleryModule {}\r\n","import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  HostListener,\r\n  OnDestroy,\r\n  OnInit,\r\n} from '@angular/core';\r\nimport { Actions, ofType } from '@ngrx/effects';\r\nimport { select, Store } from '@ngrx/store';\r\nimport { Observable, Subscription } from 'rxjs';\r\nimport { Criterion } from 'src/app/shared/interfaces/criterion.interface';\r\nimport { PictureList } from 'src/app/shared/interfaces/picture-list.interface';\r\nimport { State } from 'src/app/store';\r\nimport {\r\n  clearAllPicture,\r\n  loadPictures,\r\n  removePicture,\r\n} from 'src/app/store/picture-list/actions';\r\nimport { PictureListActionsType } from 'src/app/store/picture-list/constant';\r\nimport { selectPictureList } from 'src/app/store/picture-list/selectors';\r\nimport { selectUserUid } from 'src/app/store/user/selectors';\r\n\r\n@Component({\r\n  selector: 'app-my-gallery',\r\n  templateUrl: './my-gallery.component.html',\r\n  styleUrls: ['./my-gallery.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class MyGalleryComponent implements OnInit, OnDestroy {\r\n  public pictureList$: Observable<PictureList> = this.store$.pipe(\r\n    select(selectPictureList)\r\n  );\r\n\r\n  private uid$ = this.store$.pipe(select(selectUserUid));\r\n\r\n  private uidSubscription$: Subscription;\r\n\r\n  private pictureListSubscription$: Subscription;\r\n\r\n  private picturesUploaded: boolean;\r\n\r\n  private currentPosition: number;\r\n\r\n  public criterion: Criterion = {\r\n    limit: 10,\r\n    type: 'uid',\r\n    value: '',\r\n  };\r\n\r\n  @HostListener('window:scroll', [])\r\n  public onWindowScroll(): void {\r\n    if (\r\n      document.scrollingElement.scrollHeight -\r\n        document.scrollingElement.scrollTop -\r\n        document.scrollingElement.clientHeight <\r\n        50 &&\r\n      this.picturesUploaded &&\r\n      this.currentPosition < document.scrollingElement.scrollTop\r\n    ) {\r\n      this.picturesUploaded = false;\r\n      this.criterion.limit += 10;\r\n      this.loadPictures();\r\n    }\r\n    this.currentPosition = document.scrollingElement.scrollTop;\r\n  }\r\n\r\n  constructor(private store$: Store<State>, private actions$: Actions) {}\r\n\r\n  public ngOnInit(): void {\r\n    this.store$.dispatch(clearAllPicture());\r\n\r\n    this.uidSubscription$ = this.uid$.subscribe((uid) => {\r\n      if (uid) {\r\n        this.criterion.value = uid;\r\n        this.loadPictures();\r\n      }\r\n    });\r\n\r\n    const action = this.actions$\r\n      .pipe(ofType(PictureListActionsType.removePictureSuccess))\r\n      .subscribe(() => {\r\n        this.loadPictures();\r\n        action.unsubscribe();\r\n      });\r\n\r\n    this.pictureListSubscription$ = this.pictureList$.subscribe(() => {\r\n      this.picturesUploaded = true;\r\n    });\r\n  }\r\n\r\n  public loadPictures(): void {\r\n    const criterion = { ...this.criterion };\r\n    if (criterion.value) {\r\n      this.store$.dispatch(loadPictures({ criterion }));\r\n    }\r\n  }\r\n\r\n  public removePicture(pictureId: string): void {\r\n    this.store$.dispatch(removePicture({ pictureId }));\r\n  }\r\n\r\n  public trackByObject(index: number, item: object): number {\r\n    return index;\r\n  }\r\n\r\n  public ngOnDestroy(): void {\r\n    this.pictureListSubscription$.unsubscribe();\r\n    this.uidSubscription$.unsubscribe();\r\n  }\r\n}\r\n","<div\r\n  class=\"window-div picture\"\r\n  *ngFor=\"\r\n    let picture of pictureList$ | async | keyvalue;\r\n    trackBy: trackByObject\r\n  \"\r\n>\r\n  <div>\r\n    <p>\r\n      {{ picture.value.name }}\r\n    </p>\r\n    <button (click)=\"removePicture(picture.key)\">&#10006;</button>\r\n  </div>\r\n  <img [src]=\"picture.value.pictureSrc\" />\r\n</div>\r\n"],"sourceRoot":"webpack:///"}